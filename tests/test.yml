---
#Test package install method
- hosts: localhost
  remote_user: root
  vars:
    crystal_install_method: package
    crystal_build_deps: true
  roles:
    - "{{ ci_role_path | default('role_under_test') }}"
  post_tasks:
    - name: Get crystal version
      shell: "crystal --version | awk '{print $2}'"
      register: version_check

    - name: Assert version > 0.24.2
      assert:
        that:
          - "version_check.stdout|version_compare('0.24.2', '>=')"

- hosts: localhost
  remote_user: root
  vars:
    crystal_install_method: standalone
    crystal_revision: 2
    crystal_version: 0.24.2
    crystal_build_deps: true
  roles:
    - "{{ ci_role_path | default('role_under_test') }}"
  post_tasks:
    - name: Get crystal version
      shell: "/usr/local/bin/crystal --version | awk '{print $2}'"
      register: version_check

    - name: Assert version == {{ crystal_version }}
      assert:
        that:
          - "version_check.stdout|version_compare(crystal_version, '>=')"
